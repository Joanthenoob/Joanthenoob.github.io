(function(c,i,o,r,D,d,N,P,H,I){"use strict";function L(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function C(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var u=C(N),a=L(I);const F=o.findByDisplayName("FormText"),T=o.findByDisplayName("Switch");o.findByDisplayName("TextInput"),o.findByDisplayName("Select",!1).SingleSelect;const v=e=>({display:"flex",alignItems:"center",gap:".5rem",marginBottom:"1rem",marginLeft:e!==void 0?"1rem":0}),m=({k:e,depends:t,children:n})=>a.default.createElement("div",{style:v(t)},a.default.createElement(T,{checked:i.persist.ghost[e],disabled:t!==void 0&&!i.persist.ghost[t],onChange:s=>i.persist.store[e]=s}),a.default.createElement(F,{children:n})),w=e=>t=>(P.useNest(i.persist),e(t));((e,t=i.persist)=>{for(const n in e)t.ghost[n]===void 0&&(t.store[n]=e[n])})({scroll:!0,scrollSmooth:!0});var x=w(()=>u.createElement(u.Fragment,null,u.createElement(m,{k:"scroll"},"Scroll to keep the replying-to message on-screen"),u.createElement(m,{k:"scrollSmooth",depends:"scroll"},"Scroll smoothly")));const[{getChannel:M},{getMessages:k},j]=o.batchFind(({findByProps:e})=>{e("getDMUserIds"),e("getRawMessages"),e("setPendingReplyShouldMention")}),A=()=>M(d.getChannelId()),f=new Set;let l=-1,g=d.getChannelId(),y,h=Symbol("quickreply_deletePendingReply_int");function O(){if(!i.persist.ghost.scroll)return;const e=document.querySelector('[data-list-id="chat-messages"]');Array.from(e.children).find(n=>n.firstChild?.className?.includes("replying-"))?.scrollIntoView({behavior:i.persist.ghost.scrollSmooth?"smooth":void 0,block:"center"})}function G(e,t,n,s){typeof s>"u"&&(s=e.guild_id!==null),r.FluxDispatcher.dispatch({type:"CREATE_PENDING_REPLY",channel:e,message:t,shouldMention:n,showMentionToggle:s}),setTimeout(O,100)}function p(e){r.FluxDispatcher.dispatch({type:"DELETE_PENDING_REPLY",channelId:d.getChannelId(),...e})}function E(e){g!==e.channelId&&(g=e.channelId,l=-1)}function _(e){y=e.message.id}function R(e){y=void 0,e[h]||(l=-1)}async function b(e){if(!e.ctrlKey&&!e.metaKey||e.key!=="KeyH"&&e.key!=="KeyL")return;const t=(await k(d.getChannelId())).toArray().reverse(),n=t.findIndex(s=>s.id===y)||0;if(e.key==="KeyH"?l=n+1:e.key==="KeyL"&&(l=n-1),l>t.length&&(l=t.length),l<0)return p();p({[h]:!0}),G(A(),t[l],!f.has(d.getChannelId()))}let S;function K(){r.FluxDispatcher.subscribe("CHANNEL_SELECT",E),r.FluxDispatcher.subscribe("CREATE_PENDING_REPLY",_),r.FluxDispatcher.subscribe("DELETE_PENDING_REPLY",R),window.addEventListener("keydown",b),S=D.before("setPendingReplyShouldMention",j,e=>{e[1]?f.delete(e[0]):f.add(e[0])})}function Y(){r.FluxDispatcher.unsubscribe("CHANNEL_SELECT",E),r.FluxDispatcher.unsubscribe("CREATE_PENDING_REPLY",_),r.FluxDispatcher.unsubscribe("DELETE_PENDING_REPLY",R),window.removeEventListener("keydown",b),S?.()}return c.onLoad=K,c.onUnload=Y,c.settings=x,Object.defineProperty(c,"__esModule",{value:!0}),c})({},cumcord.pluginData,cumcord.modules.webpack,cumcord.modules.common,cumcord.patcher,cumcord.modules.common.channels,cumcord.modules.common.React,cumcord.utils,cumcord.plugins,cumcord.modules.common.React);
