(function(s,u,D,r,_,o,R,c){"use strict";function S(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var a=S(R);c.setDefaults({scroll:!0,scrollSmooth:!0,noPing:!1});var w=c.dependPersist(()=>a.createElement(a.Fragment,null,a.createElement(c.SSwitch,{k:"scroll"},"Scroll to keep the replying-to message on-screen"),a.createElement(c.SSwitch,{k:"scrollSmooth",depends:"scroll"},"Scroll smoothly"),a.createElement(c.SSwitch,{k:"noPing"},"Don't ping the original author of your reply by default")));const[{getChannel:C},{getMessages:I},N]=D.batchFind(({findByProps:e})=>{e("getDMUserIds"),e("getRawMessages"),e("setPendingReplyShouldMention")}),L=()=>C(o.getChannelId()),d=new Set;let l=-1,h=o.getChannelId(),g,f=Symbol("quickreply_deletePendingReply_int");function k(){if(!u.persist.ghost.scroll)return;const e=document.querySelector('[data-list-id="chat-messages"]');Array.from(e.children).find(n=>n.firstChild?.className?.includes("replying-"))?.scrollIntoView({behavior:u.persist.ghost.scrollSmooth?"smooth":void 0,block:"center"})}function A(e,t,n,i){typeof i>"u"&&(i=e.guild_id!==null),r.FluxDispatcher.dispatch({type:"CREATE_PENDING_REPLY",channel:e,message:t,shouldMention:n&&!u.persist.ghost.noPing,showMentionToggle:i}),setTimeout(k,100)}function p(e){r.FluxDispatcher.dispatch({type:"DELETE_PENDING_REPLY",channelId:o.getChannelId(),...e})}function y(e){h!==e.channelId&&(h=e.channelId,l=-1)}function E(e){g=e.message.id}function b(e){g=void 0,e[f]||(l=-1)}async function m(e){if(!e.ctrlKey&&!e.metaKey||e.key!=="ArrowUp"&&e.key!=="ArrowDown")return;const t=(await I(o.getChannelId())).toArray().reverse(),n=t.findIndex(i=>i.id===g)||0;if(e.key==="ArrowUp"?l=n+1:e.key==="ArrowDown"&&(l=n-1),l>t.length&&(l=t.length),l<0)return p();p({[f]:!0}),A(L(),t[l],!d.has(o.getChannelId()))}let P;function M(){r.FluxDispatcher.subscribe("CHANNEL_SELECT",y),r.FluxDispatcher.subscribe("CREATE_PENDING_REPLY",E),r.FluxDispatcher.subscribe("DELETE_PENDING_REPLY",b),window.addEventListener("keydown",m),P=_.before("setPendingReplyShouldMention",N,e=>{e[1]?d.delete(e[0]):d.add(e[0])})}function F(){r.FluxDispatcher.unsubscribe("CHANNEL_SELECT",y),r.FluxDispatcher.unsubscribe("CREATE_PENDING_REPLY",E),r.FluxDispatcher.unsubscribe("DELETE_PENDING_REPLY",b),window.removeEventListener("keydown",m),P?.()}return s.onLoad=M,s.onUnload=F,s.settings=w,Object.defineProperty(s,"__esModule",{value:!0}),s})({},cumcord.pluginData,cumcord.modules.webpack,cumcord.modules.common,cumcord.patcher,cumcord.modules.common.channels,cumcord.modules.common.React,cumcordTools);
