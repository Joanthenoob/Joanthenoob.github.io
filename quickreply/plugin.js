(function(o,s,c,l,S,d,D,N,U,I){"use strict";function C(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function L(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var u=L(D),a=C(I);const F=c.findByDisplayName("FormText"),T=c.findByDisplayName("Switch");c.findByDisplayName("TextInput"),c.findByDisplayName("Select",!1).SingleSelect;const v=e=>({display:"flex",alignItems:"center",gap:".5rem",marginBottom:"1rem",marginLeft:e!==void 0?"1rem":0}),f=({k:e,depends:t,children:n})=>a.default.createElement("div",{style:v(t)},a.default.createElement(T,{checked:s.persist.ghost[e],disabled:t!==void 0&&!s.persist.ghost[t],onChange:r=>s.persist.store[e]=r}),a.default.createElement(F,{children:n})),w=e=>t=>(N.useNest(s.persist),e(t));((e,t=s.persist)=>{for(const n in e)t.ghost[n]===void 0&&(t.store[n]=e[n])})({scroll:!0,scrollSmooth:!0,noPing:!1});var x=w(()=>u.createElement(u.Fragment,null,u.createElement(f,{k:"scroll"},"Scroll to keep the replying-to message on-screen"),u.createElement(f,{k:"scrollSmooth",depends:"scroll"},"Scroll smoothly"),u.createElement(f,{k:"noPing"},"Don't ping the original author of your reply by default")));const[{getChannel:M},{getMessages:k},j]=c.batchFind(({findByProps:e})=>{e("getDMUserIds"),e("getRawMessages"),e("setPendingReplyShouldMention")}),A=()=>M(d.getChannelId()),y=new Set;let i=-1,h=d.getChannelId(),g,m=Symbol("quickreply_deletePendingReply_int");function O(){if(!s.persist.ghost.scroll)return;const e=document.querySelector('[data-list-id="chat-messages"]');Array.from(e.children).find(n=>n.firstChild?.className?.includes("replying-"))?.scrollIntoView({behavior:s.persist.ghost.scrollSmooth?"smooth":void 0,block:"center"})}function G(e,t,n,r){typeof r>"u"&&(r=e.guild_id!==null),l.FluxDispatcher.dispatch({type:"CREATE_PENDING_REPLY",channel:e,message:t,shouldMention:n&&!s.persist.ghost.noPing,showMentionToggle:r}),setTimeout(O,100)}function p(e){l.FluxDispatcher.dispatch({type:"DELETE_PENDING_REPLY",channelId:d.getChannelId(),...e})}function E(e){h!==e.channelId&&(h=e.channelId,i=-1)}function _(e){g=e.message.id}function b(e){g=void 0,e[m]||(i=-1)}async function P(e){if(!e.ctrlKey&&!e.metaKey||e.key!=="h"&&e.key!=="l")return;const t=(await k(d.getChannelId())).toArray().reverse(),n=t.findIndex(r=>r.id===g)||0;if(e.key==="h"?i=n+1:e.key==="l"&&(i=n-1),i>t.length&&(i=t.length),i<0)return p();p({[m]:!0}),G(A(),t[i],!y.has(d.getChannelId()))}let R;function Y(){l.FluxDispatcher.subscribe("CHANNEL_SELECT",E),l.FluxDispatcher.subscribe("CREATE_PENDING_REPLY",_),l.FluxDispatcher.subscribe("DELETE_PENDING_REPLY",b),window.addEventListener("keydown",P),R=S.before("setPendingReplyShouldMention",j,e=>{e[1]?y.delete(e[0]):y.add(e[0])})}function B(){l.FluxDispatcher.unsubscribe("CHANNEL_SELECT",E),l.FluxDispatcher.unsubscribe("CREATE_PENDING_REPLY",_),l.FluxDispatcher.unsubscribe("DELETE_PENDING_REPLY",b),window.removeEventListener("keydown",P),R?.()}return o.onLoad=Y,o.onUnload=B,o.settings=x,Object.defineProperty(o,"__esModule",{value:!0}),o})({},cumcord.pluginData,cumcord.modules.webpack,cumcord.modules.common,cumcord.patcher,cumcord.modules.common.channels,cumcord.modules.common.React,cumcord.utils,cumcord.plugins,cumcord.modules.common.React);
