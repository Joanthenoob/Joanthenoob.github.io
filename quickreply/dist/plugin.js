(function(c,r,o,s,D,d,N,P,U,I){"use strict";function C(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function L(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var u=L(N),a=C(I);const F=o.findByDisplayName("FormText"),T=o.findByDisplayName("Switch");o.findByDisplayName("TextInput"),o.findByDisplayName("Select",!1).SingleSelect;const v=e=>({display:"flex",alignItems:"center",gap:".5rem",marginBottom:"1rem",marginLeft:e!==void 0?"1rem":0}),y=({k:e,depends:t,children:n})=>a.default.createElement("div",{style:v(t)},a.default.createElement(T,{checked:r.persist.ghost[e],disabled:t!==void 0&&!r.persist.ghost[t],onChange:i=>r.persist.store[e]=i}),a.default.createElement(F,{children:n})),w=e=>t=>(P.useNest(r.persist),e(t));((e,t=r.persist)=>{for(const n in e)t.ghost[n]===void 0&&(t.store[n]=e[n])})({scroll:!0,scrollSmooth:!0});var x=w(()=>u.createElement(u.Fragment,null,u.createElement(y,{k:"scroll"},"Scroll to keep the replying-to message on-screen"),u.createElement(y,{k:"scrollSmooth",depends:"scroll"},"Scroll smoothly")));const[{getChannel:M},{getMessages:k},j]=o.batchFind(({findByProps:e})=>{e("getDMUserIds"),e("getRawMessages"),e("setPendingReplyShouldMention")}),A=()=>M(d.getChannelId()),f=new Set;let l=-1,h=d.getChannelId(),m,g=Symbol("quickreply_deletePendingReply_int");function O(){if(!r.persist.ghost.scroll)return;const e=document.querySelector('[data-list-id="chat-messages"]');Array.from(e.children).find(n=>n.firstChild?.className?.includes("replying-"))?.scrollIntoView({behavior:r.persist.ghost.scrollSmooth?"smooth":void 0,block:"center"})}function G(e,t,n){typeof n>"u"&&(n=e.guild_id!==null),s.FluxDispatcher.dispatch({type:"CREATE_PENDING_REPLY",channel:e,message:t,shouldMention,showMentionToggle:n}),setTimeout(O,100)}function p(e){s.FluxDispatcher.dispatch({type:"DELETE_PENDING_REPLY",channelId:d.getChannelId(),...e})}function E(e){h!==e.channelId&&(h=e.channelId,l=-1)}function _(e){m=e.message.id}function R(e){m=void 0,e[g]||(l=-1)}async function b(e){if(!e.ctrlKey&&!e.metaKey||e.key!=="h"&&e.key!=="l")return;const t=(await k(d.getChannelId())).toArray().reverse(),n=t.findIndex(i=>i.id===m)||0;if(e.key==="h"?l=n+1:e.key==="l"&&(l=n-1),l>t.length&&(l=t.length),l<0)return p();p({[g]:!0}),G(A(),t[l],!f.has(d.getChannelId()))}let S;function Y(){s.FluxDispatcher.subscribe("CHANNEL_SELECT",E),s.FluxDispatcher.subscribe("CREATE_PENDING_REPLY",_),s.FluxDispatcher.subscribe("DELETE_PENDING_REPLY",R),window.addEventListener("keydown",b),S=D.before("setPendingReplyShouldMention",j,e=>{e[1]?f.delete(e[0]):f.add(e[0])})}function B(){s.FluxDispatcher.unsubscribe("CHANNEL_SELECT",E),s.FluxDispatcher.unsubscribe("CREATE_PENDING_REPLY",_),s.FluxDispatcher.unsubscribe("DELETE_PENDING_REPLY",R),window.removeEventListener("keydown",b),S?.()}return c.onLoad=Y,c.onUnload=B,c.settings=x,Object.defineProperty(c,"__esModule",{value:!0}),c})({},cumcord.pluginData,cumcord.modules.webpack,cumcord.modules.common,cumcord.patcher,cumcord.modules.common.channels,cumcord.modules.common.React,cumcord.utils,cumcord.plugins,cumcord.modules.common.React);
