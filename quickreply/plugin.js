(function(s,u,_,l,R,c,D,o){"use strict";function S(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var a=S(D);o.setDefaults({scroll:!0,scrollSmooth:!0,noPing:!1});var C=o.dependPersist(()=>a.createElement(a.Fragment,null,a.createElement(o.SSwitch,{k:"scroll"},"Scroll to keep the replying-to message on-screen"),a.createElement(o.SSwitch,{k:"scrollSmooth",depends:"scroll"},"Scroll smoothly"),a.createElement(o.SSwitch,{k:"noPing"},"Don't ping the original author of your reply by default")));const[{getChannel:I},{getMessages:N},L]=_.batchFind(({findByProps:e})=>{e("getDMUserIds"),e("getRawMessages"),e("setPendingReplyShouldMention")}),w=()=>I(c.getChannelId()),d=new Set;let r=-1,h=c.getChannelId(),g,f=Symbol("quickreply_deletePendingReply_int");function k(){if(!u.persist.ghost.scroll)return;const e=document.querySelector('[data-list-id="chat-messages"]');Array.from(e.children).find(n=>n.firstChild?.className?.includes("replying-"))?.scrollIntoView({behavior:u.persist.ghost.scrollSmooth?"smooth":void 0,block:"center"})}function M(e,t,n,i){typeof i>"u"&&(i=e.guild_id!==null),l.FluxDispatcher.dispatch({type:"CREATE_PENDING_REPLY",channel:e,message:t,shouldMention:n&&!u.persist.ghost.noPing,showMentionToggle:i}),setTimeout(k,100)}function p(e){l.FluxDispatcher.dispatch({type:"DELETE_PENDING_REPLY",channelId:c.getChannelId(),...e})}function y(e){h!==e.channelId&&(h=e.channelId,r=-1)}function E(e){g=e.message.id}function b(e){g=void 0,e[f]||(r=-1)}async function m(e){if(!e.ctrlKey&&!e.metaKey||e.key!=="h"&&e.key!=="l")return;const t=(await N(c.getChannelId())).toArray().reverse(),n=t.findIndex(i=>i.id===g)||0;if(e.key==="h"?r=n+1:e.key==="l"&&(r=n-1),r>t.length&&(r=t.length),r<0)return p();p({[f]:!0}),M(w(),t[r],!d.has(c.getChannelId()))}let P;function F(){l.FluxDispatcher.subscribe("CHANNEL_SELECT",y),l.FluxDispatcher.subscribe("CREATE_PENDING_REPLY",E),l.FluxDispatcher.subscribe("DELETE_PENDING_REPLY",b),window.addEventListener("keydown",m),P=R.before("setPendingReplyShouldMention",L,e=>{e[1]?d.delete(e[0]):d.add(e[0])})}function v(){l.FluxDispatcher.unsubscribe("CHANNEL_SELECT",y),l.FluxDispatcher.unsubscribe("CREATE_PENDING_REPLY",E),l.FluxDispatcher.unsubscribe("DELETE_PENDING_REPLY",b),window.removeEventListener("keydown",m),P?.()}return s.onLoad=F,s.onUnload=v,s.settings=C,Object.defineProperty(s,"__esModule",{value:!0}),s})({},cumcord.pluginData,cumcord.modules.webpack,cumcord.modules.common,cumcord.patcher,cumcord.modules.common.channels,cumcord.modules.common.React,cumcordTools);
